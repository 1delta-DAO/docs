
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Margin Aggregation Â· 1delta docs</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.0.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/honkit-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-add-js-css/3d91900d8e69e1fa40dcb544be882eaf-footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-add-js-css/909a4ef7af68c71df4d1f8e3cbeb2994-asciinema-player.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-add-js-css/c459563c02e09e58ef33c91554d24a1e-prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-add-js-css/a7e0e775e45122c306152e5095d6066a-code.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/honkit-plugin-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/honkit-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="guide/overview.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="margin-aggregation.html">
            
                <a href="margin-aggregation.html">
            
                    
                    Margin Aggregation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="guide/overview.html">
            
                <a href="guide/overview.html">
            
                    
                    Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="guide/frontend.html">
            
                <a href="guide/frontend.html">
            
                    
                    Frontend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="guide/programmatically.html">
            
                <a href="guide/programmatically.html">
            
                    
                    Programmatically
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="architecture/overview.html">
            
                <a href="architecture/overview.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="lenders/summary.html">
            
                <a href="lenders/summary.html">
            
                    
                    Lenders
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="lenders/metrics.html">
            
                <a href="lenders/metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="contract-addresses/summary.html">
            
                <a href="contract-addresses/summary.html">
            
                    
                    Contract Addresses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="api/summary.html">
            
                <a href="api/summary.html">
            
                    
                    Contract API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="api/entrypoint.html">
            
                <a href="api/entrypoint.html">
            
                    
                    Entrypoint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="api/operations.html">
            
                <a href="api/operations.html">
            
                    
                    Operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.1" data-path="api/transfers.html">
            
                <a href="api/transfers.html">
            
                    
                    Transfers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.2" data-path="api/external-call.html">
            
                <a href="api/external-call.html">
            
                    
                    External Call
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.2.1" data-path="api/bridge/bridge.html">
            
                <a href="api/bridge/bridge.html">
            
                    
                    Bridging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.2.1.1" data-path="api/bridge/stargate.html">
            
                <a href="api/bridge/stargate.html">
            
                    
                    Stargate V2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.2.1.2" data-path="api/bridge/across.html">
            
                <a href="api/bridge/across.html">
            
                    
                    Across
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2.3" data-path="api/lending.html">
            
                <a href="api/lending.html">
            
                    
                    Lending
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.3.1" data-path="api/lending/aave.html">
            
                <a href="api/lending/aave.html">
            
                    
                    Aave
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.3.2" data-path="api/lending/compound-v3.html">
            
                <a href="api/lending/compound-v3.html">
            
                    
                    Compound V3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.3.3" data-path="api/lending/compound-v2.html">
            
                <a href="api/lending/compound-v2.html">
            
                    
                    Compound V2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.3.4" data-path="api/lending/morpho.html">
            
                <a href="api/lending/morpho.html">
            
                    
                    Morpho Blue
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2.4" data-path="api/flash-loan.html">
            
                <a href="api/flash-loan.html">
            
                    
                    Flash Loan
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.4.1" data-path="api/flash-loan/standardized-interface.html">
            
                <a href="api/flash-loan/standardized-interface.html">
            
                    
                    Standardized Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.4.2" data-path="api/flash-loan/singletons.html">
            
                <a href="api/flash-loan/singletons.html">
            
                    
                    Singletons
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2.5" data-path="api/margin/general.html">
            
                <a href="api/margin/general.html">
            
                    
                    Margin
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.5.1" data-path="api/margin/leverage.html">
            
                <a href="api/margin/leverage.html">
            
                    
                    Leverage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5.2" data-path="api/margin/close.html">
            
                <a href="api/margin/close.html">
            
                    
                    Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5.3" data-path="api/margin/collateral-swap.html">
            
                <a href="api/margin/collateral-swap.html">
            
                    
                    Collateral Swap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5.4" data-path="api/margin/debt-swap.html">
            
                <a href="api/margin/debt-swap.html">
            
                    
                    Debt Swap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5.5" data-path="api/margin/migration.html">
            
                <a href="api/margin/migration.html">
            
                    
                    Migration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Margin Aggregation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="margin-aggregation">Margin Aggregation</h1>
<h2 id="margin-trading-in-crypto">Margin Trading In Crypto</h2>
<p>Margin trading for cryptocurrencies is a financial strategy that enables investors to trade digital assets like Bitcoin, Ethereum, and other altcoins using borrowed funds from a broker or exchange. This approach allows traders to increase their purchasing power and enhance their profit potential by leveraging their existing capital. However, it's essential to remember that margin trading also entails higher risks and can lead to significant losses if the market moves against the trader's position.</p>
<p>In cryptocurrency margin trading, investors can access leverage, which is essentially a multiplier that amplifies the trader's capital. For example, if a trader uses 5x leverage, a $1,000 investment would provide them with $5,000 worth of purchasing power in the market. This increased exposure can lead to substantial gains if the market moves in their favor, but it can also magnify losses if the market goes against them.</p>
<p>To engage in margin trading, traders are required to deposit an initial margin (or collateral) into a lending protocol. This collateral serves as a guarantee for the borrowed funds and is calculated as a percentage of the total position value. Different lenders may have different margin requirements, and traders should be aware of the specific policies of their chosen platform.</p>
<p>When margin trading cryptocurrencies, it's crucial to understand the concept of liquidation. Liquidation occurs when the market moves against a trader's position to the point where their collateral is no longer sufficient to cover their losses. Lenders usually measure this using the <strong>health factor</strong>.</p>
<p>In such a case, the health factor drops below 1 and the wallet will be flagged for liquidation, allowing another actor to close part of the position to recover the borrowed funds.</p>
<p>In summary, margin trading for cryptocurrencies is a high-risk, high-reward trading strategy that can lead to significant profits or losses, depending on market movements. It's best suited for experienced traders who have a solid understanding of market dynamics and can effectively manage risk.</p>
<h2 id="margin-trading-in-defi">Margin Trading In DeFi</h2>
<p>To open margin positions, users can manually loop through the following steps if they want to open an ETH-long position with 4x leverage.</p>
<ol>
<li>Supply initial collateral in ETH worth $1,000</li>
<li>Borrow $800 worth of USDC (80% of %1,000)</li>
<li>Swap to ETH and supply again - This will give us another $640 (80% of $800) in borrowing capacity. We will now repeat this cycle until we obtained our target leverage.<ol>
<li>Borrow $640 (80% of $800), swap an supply</li>
<li>Borrow $512 (80% of $640), swap an supply</li>
<li>Borrow $409.6 (80% of $512), swap an supply</li>
<li>Borrow $327.68 (80% of$409.6), swap an supply</li>
<li>Borrow $262.144 (80% of$327.68), swap an supply</li>
<li>Borrow $48.576 (the remaining amount to bring the total borrowed funds to $3,000)</li>
</ol>
</li>
</ol>
<p>We see that building this leverage takes 22 transactions to complete as each sub-step in step 3. consists of 3 separate transactions. The following chart summarizes the general procedure.</p>
<p></p><p align="center">
  <img src="assets/manual-looping.png"></img>
</p>
<em>1) A first USDT deposit is required for taking out a loan; 2) we can borrow WBTC to our wallet; 3) we swap WBTC to USDT on a DEX; 4) we deposit USDT to the lender; we repeat from step 2) until we reach the desired position size.</em><p></p>
<p>Certainly, this cannot be the long-term solution to DeFi margin trading. 1delta uses unique methods and implementations that allow opening such positions in a maximum of 2 transactions, where the first one is just the initial supply of the collateral.</p>
<h2 id="how-1delta-automates-the-flow">How 1delta Automates The Flow</h2>
<p>We illustrate the example above using the 1delta protocol.</p>
<ol>
<li>Supply initial collateral in ETH worth $1,000</li>
<li>We use a flash swap and receive $3,000 of ETH and supply<ol>
<li>We supply the obtained ETH</li>
<li>We can now borrow 80% of the $4,000 ($3,200) in USDC the we supplied, we borrow $3,000</li>
<li>We repay the swap pool with the obtained $3,000 in USDC</li>
</ol>
</li>
</ol>
<p>All sub-steps in step 2. happen within the same transaction. As such, there is no more manual looping when trying to build a leveraged position when using lending protocols. The following chart summarizes the interactions with the lender.</p>
<p></p><p align="center">
  <img src="assets/delegation-automation.png"></img>
</p>
<em>Illustration of a swap router architecture that can open positions (borrow and supply) with flash swaps or flash loans in only two steps.</em><p></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="guide/overview.html" class="navigation navigation-next " aria-label="Next page: Guide">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Margin Aggregation","level":"1.2","depth":1,"next":{"title":"Guide","level":"1.3","depth":1,"path":"guide/overview.md","ref":"./guide/overview.md","articles":[{"title":"Frontend","level":"1.3.1","depth":2,"path":"guide/frontend.md","ref":"./guide/frontend.md","articles":[]},{"title":"Programmatically","level":"1.3.2","depth":2,"path":"guide/programmatically.md","ref":"./guide/programmatically.md","articles":[]}]},"previous":{"title":"Introduction","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","honkit-plugin-prism","add-js-css","edit-link","flexible-alerts","insert-logo","pagefooter","-lunr","-search","search-plus","livereload"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"honkit-plugin-prism":{"theme":"solarized-dark"},"livereload":{},"pagefooter":{"footer":"<div>Â© 1delta <a href='https://1delta.io/'>https://1delta.io/</a></br>Found an error in the docs? The source code can be found <a href='https://github.com/1delta-DAO/docs/blob/main/README.md'>here</a>. Please feel free to edit and contribute a merge request<div>","label":"Modified at: ","format":"YYYY-MM-DD HH:mm:ss","utc":true},"add-js-css":{"js":["./scripts/asciinema-player.js","./scripts/code-header.js"],"css":["./style/footer.css","./style/asciinema-player.css","./style/prism-okaidia.css","./style/code.css"]},"fontsettings":{"theme":"white","family":"sans","size":2},"flexible-alerts":{"style":"callout","note":{"label":"Note","icon":"fa fa-info-circle","className":"info"},"tip":{"label":"Tip","icon":"fa fa-lightbulb-o","className":"tip"},"warning":{"label":"Warning","icon":"fa fa-exclamation-triangle","className":"warning"},"danger":{"label":"Attention","icon":"fa fa-ban","className":"danger"}},"edit-link":{"label":"Edit on GitHub","base":"https://github.com/1delta-DAO/docs/blob/main"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"insert-logo":{"url":"https://raw.githubusercontent.com/1delta-DAO/protocol-icons/main/1delta_logo.svg","style":"background: #0f1823; width: 100%; padding: 20px; margin: 0px; border-radius: 15px;"},"search-plus":{}},"theme":"default","honkit":">=3.0.0","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"esversion":"2019","nodeversion":"12.13.0","npmversion":"6.12.0","triplebackticks":"```","console":"<a class=\"gitbook-plugin-js-console\" aria-hidden=\"true\"></a>"},"title":"1delta docs","gitbook":">=3.0.0"},"file":{"path":"margin-aggregation.md","mtime":"2025-08-07T21:20:21.647Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-09-04T11:33:21.462Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-add-js-css/a33932e9fa4924be93aca241a9233fd4-asciinema-player.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-add-js-css/b97f14b103e988bf094faf9ea9f6d77c-code-header.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="gitbook/honkit-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/honkit-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

